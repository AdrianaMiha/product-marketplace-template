{% assign CANT_BE_BLANK = "can't be blank" %}

<!-- convert tags -->
{% liquid
  assign tags = item.properties.tags | split: ','
  assign properties = item.properties
  assign properties = properties | add_hash_key: 'tags', tags
  assign properties = properties | add_hash_key: 'owner', context.session.current_user_id
%}

{% liquid
  assign valid = true
  assign errors = '{}' | parse_json
  assign perrors = '{}' | parse_json
  assign errors = errors | add_hash_key: "properties", perrors

  if item.properties.name == "" or item.properties.name == null
    assign valid = false
    assign perrors = perrors | add_hash_key: "name", CANT_BE_BLANK
  endif

  if item.properties.description == ""
    include 'data/items/wiki', name: item.properties.name

    assign properties = properties | add_hash_key: 'description', context.exports.wiki.about
  endif

  if item.properties.description == ""
    assign valid = false
    assign perrors = perrors | add_hash_key: "description", CANT_BE_BLANK
  endif

  if item.properties.owner == "" or item.properties.owner == null
    assign valid = false
    assign perrors = perrors | add_hash_key: "owner", CANT_BE_BLANK
  endif

  assign item = item | add_hash_key: 'errors', errors

  export item
  export valid,  namespace: 'item'
  export errors, namespace: 'item'
%}
