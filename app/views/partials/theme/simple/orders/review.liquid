
<div>
  <h3 class="text-xl font-bold mb-4 md:hidden">
    Please confirm and submit your order
  </h3>

  <form action="/orders/pay" id="pay-form" method="post" class="mt-2"
    data-checkout-session-id={{checkout_session.id}}
    data-stripe-pk-key={{ context.constants.stripe_pk_key }}
  >
    {% include 'authenticity_token' %}
    <input type="hidden" name="status" value="app.order_statuses.paid"/>
    <input type="hidden" name="order_id" value="{{ order.id }}"/>

    order: {{order}}<br>
    checkout_session: {{ checkout_session  }}

    <button class="button button-sm">
      {{ 'app.pay' | t }}
    </button>
  </form>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
  const form = document.getElementById('pay-form');
  const checkoutButton = form.querySelector('button');
  const stripe = Stripe(form.dataset.stripePkKey);

  checkoutButton.addEventListener('click', (evt) => {
    evt.preventDefault();
    stripe.redirectToCheckout({
      // Make the id field from the Checkout Session creation API response
      // available to this file, so you can provide it as argument here
      // instead of the {{CHECKOUT_SESSION_ID}} placeholder.
      sessionId: form.dataset.checkoutSessionId
    })
    // If `redirectToCheckout` fails due to a browser or network
    // error, display the localized error message to your customer
    // using `error.message`.
  });
</script>
