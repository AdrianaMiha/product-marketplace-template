{% assign MINIMAL_TOTAL = 10 %}

{% assign total = item.price | default: 0 %}

{% parse_json order %}
{
  "item_id": "{% print item.id %}",
  "buyer":   "{% echo current_user_id %}",
  "seller":  "{% echo item.owner.id %}",
  "total":    {% echo total %},
  "name":  "init"
}
{% endparse_json %}

{% liquid
  assign valid = true
  assign errors = '{}' | parse_json

  if order.seller == order.buyer
    assign valid = false
    include 'lib/register_error', hash: errors, field_name: 'base', key: 'app.errors.cannot_sell_to_yourself'
  endif

  if order.seller == "" or order.seller == null
    assign valid = false
    include 'lib/register_error', hash: errors, field_name: 'seller', key: 'app.errors.blank'
  endif

  if order.buyer == "" or order.buyer == null
    assign valid = false
    include 'lib/register_error', hash: errors, field_name: 'buyer', key: 'app.errors.blank'
  endif

  if order.item_id == "" or order.item_id == null
    assign valid = false
    include 'lib/register_error', hash: errors, field_name: 'item_it', key: 'app.errors.blank'
  endif

  if order.total < MINIMAL_TOTAL
    assign valid = false
    include 'lib/register_error', hash: errors, field_name: 'total', key: 'app.errors.too_little'
  endif
%}

{% liquid
  export order
  export errors, namespace: 'order'
  export valid,  namespace: 'order'
%}
