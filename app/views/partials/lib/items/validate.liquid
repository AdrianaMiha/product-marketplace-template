{% assign MINIMAL_PRICE = 10 %}

<!-- convert tags -->
{% parse_json item %}
  {
    "id":          {{ item.id | json }},
    "owner":       {{ owner | json }},
    "name":        {{ item.name | json }},
    "cover_photo": {{ item.cover_photo | json }},
    "tags":        {{ item.tags | split: ',' }},
    "description": {{ item.description | default: "" | json }},
    "type":        {{ item.type | default: "" | json }},
    "price":       {{ item.price | plus: 0 }},
    "uuid":        {{ item.uuid | json }}
  }
{% endparse_json %}

{% liquid
  assign valid = true
  assign errors = '{}' | parse_json

  if item.owner == "" or item.owner == null
    assign valid = false
    include 'lib/register_error', hash: errors, field_name: 'owner', key: 'app.errors.blank'
  endif

  if item.name == "" or item.name == null
    assign valid = false
    include 'lib/register_error', hash: errors, field_name: 'name', key: 'app.errors.blank'
  endif

  if item.price <  MINIMAL_PRICE
    assign valid = false
    assign msg = 'app.errors.too_little' | t: value: MINIMAL_PRICE
    include 'lib/register_error', hash: errors, field_name: 'price', message: msg
  endif

  if item.description == ""
    assign valid = false
    include 'lib/register_error', hash: errors, field_name: 'description', key: 'app.errors.blank'
  endif

  if item.uuid == "" or item.uuid == null
    assign valid = false
    include 'lib/register_error', hash: errors, field_name: 'uuid', key: 'app.errors.blank'
  endif

  export item
  export valid,  namespace: 'item'
  export errors, namespace: 'item'
%}
