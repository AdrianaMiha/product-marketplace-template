{% liquid
  log event, type: 'showme from consumers'
  include 'lib/queries/orders/find', id: event.target.id
  include 'lib/queries/items/find',  id: context.exports.order.properties.item_id

  log context.exports.order, type: 'showme from consumers'
  log context.exports.item, type: 'showme from consumers'

  assign order_status = context.exports.order.status.name

  if order_status == 'app.order_statuses.paid'

    include 'lib/item_statuses/create/build', item_id: context.exports.item.id, name: 'app.item_statuses.sold'
    include 'lib/item_statuses/create/check', object: context.exports.object

    if context.exports.object.valid
      include 'lib/item_statuses/create/execute', object: context.exports.object
    else
      log context.exports.object, type: 'showme'
    endif
  endif
%}
