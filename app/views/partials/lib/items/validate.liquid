{% assign CANT_BE_BLANK = "can't be blank" %}
{% assign MINIMAL_PRICE = 10 %}
{% assign TOO_LITTLE = "has to be equal or greater than " | append: MINIMAL_PRICE %}

<!-- convert tags -->
{% liquid
  assign tags = item.properties.tags | split: ','
  assign properties = item.properties
  assign properties = properties | add_hash_key: 'tags', tags

  if current_user_id
    assign properties = properties | add_hash_key: 'owner', current_user_id
  endif

  assign price = item.properties.price | plus: 0
  assign properties = properties | add_hash_key: 'price', price
%}

{% liquid
  assign valid = true
  assign errors = '{}' | parse_json
  assign perrors = '{}' | parse_json
  assign errors = errors | add_hash_key: "properties", perrors

  if item.properties.name == "" or item.properties.name == null
    assign valid = false
    assign perrors = perrors | add_hash_key: "name", CANT_BE_BLANK
  endif

  if item.properties.price <  MINIMAL_PRICE
    assign valid = false
    assign perrors = perrors | add_hash_key: "price", TOO_LITTLE
  endif

  if item.properties.description == ""
    assign valid = false
    assign perrors = perrors | add_hash_key: "description", CANT_BE_BLANK
  endif

  if item.properties.uuid == "" or item.properties.uuid == null
    assign valid = false
    assign perrors = perrors | add_hash_key: "uuid", CANT_BE_BLANK
  endif

  assign item = item | add_hash_key: 'errors', errors

  export item
  export valid,  namespace: 'item'
  export errors, namespace: 'item'
%}
